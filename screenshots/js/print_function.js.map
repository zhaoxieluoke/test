{"version":3,"sources":["../es6/print_function.js"],"names":["print","config","iClientY","iClientX","iOffsetX","iOffsetY","is_start","drop_width","drop_height","$out_container","$","container","append","$container","$file","find","$complete_box","$canvas","ctx","getContext","$clip","clip_ctx","on","files","length","file_type","type","DOMString_url","URL","createObjectURL","indexOf","img","Image","src","onload","img_scale","width","height","css","drawImage","choosed_area","title","left","top","event","pageY","pageX","offset","print_top","print_left","drop_top_final","drop_left_final","distance_x_limit","distance_y_limit","forEach","ele","index","choosed_top_final","choosed_left_final","clipImg","getImageData","set","putImageData","imgurl","toDataURL","prop","position_txt","html","after","reset_position","trigger","bindModelInput","obj","property","domElem","Object","defineProperty","get","value","newValue","configurable","user","document","getElementById"],"mappings":"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","file":"print_function.js","sourcesContent":["    let print = function print(config) {\n        \n        //初始变量\n        let \n            iClientY,\n            iClientX,\n            iOffsetX,\n            iOffsetY,\n            is_start,\n            drop_width,\n            drop_height,\n            $out_container = $(`${config.container}`);\n        $out_container.append(`\n            <input type=\"file\">\n            <div class=\"container-box\">\n                <div class=\"complete-box\"></div>\n                <div class=\"drop-box\"></div>\n                <canvas class=\"canvas\"></canvas>\n                <canvas class=\"clip\"></canvas>\n            </div>\n        `);\n        let $container = $('.container-box');\n        let $file = $out_container.find('input[type=file]');\n        let $complete_box = $container.find('.complete-box');\n        let $canvas = $container.find('.canvas');\n        let ctx = $canvas[0].getContext('2d');\n        let $clip = $container.find('.clip');\n        let clip_ctx = $clip[0].getContext('2d');\n        //上传 展示图片\n        $file.on('change', function(){\n            if(this.files.length > 0){\n                let file_type = this.files[0].type;\n                let DOMString_url = URL.createObjectURL(this.files[0]);\n                if(file_type.indexOf('image') > -1) {\n                    // $img.src = DOMString_url;\n                    let img = new Image();\n                    img.src = DOMString_url;\n                    //等待图片加载\n                    img.onload = function() {\n                        //设置图片展示容器宽高\n                        let img_scale = img.width / img.height;\n                        img.height > 400 ? $container.height(400): $container.height(img.height);\n                        img_scale > 1 ? $container.width( $container.height() * img_scale ) : $container.width( $container.height() / img_scale );\n                        $container.css({\n                            'background': `url(${DOMString_url})  center/contain no-repeat`\n                        })\n                        //绘制canvas图片\n                        $canvas[0].height = $container.height();\n                        $canvas[0].width = $container.width();\n                       \n                       ctx.drawImage(img, 0, 0, $container.width(), $container.height());\n                    }\n                    return false;\n                }\n            }\n        })\n\n        //已经选择的区域信息存储\n        let choosed_area = [\n                {\n                    title: '第一版',\n                    left: 100,\n                    top: 100,\n                    width: 100,\n                    height: 100\n                }\n            ];\n        \n        //鼠标按下 记录初始位置 定位\n        $container.on('mousedown', function(event){\n            if($file[0].files.length === 0) return false;\n            iClientY = event.pageY;\n            iClientX = event.pageX;\n            iOffsetX = iClientX - $container.offset().left;\n            iOffsetY = iClientY - $container.offset().top;\n            //\n            if($('.complete-box').css('display') == 'none') {\n                is_start = true;\n            }\n            //起始位置边界检测\n            let print_top = iClientY - $container.offset().top; //当前选定区域 top\n            let print_left = iClientX - $container.offset().left; //当前选定区域 left\n\n            //开始绘制\n            if(is_start) {\n                //是 记录矩形起始坐标\n                $('.drop-box').css({\n                    'top': `${iOffsetY}px`,\n                    'left': `${iOffsetX}px`,\n                    'display': `block`,\n                    'position': `absolute`\n                });\n            }\n            return false;\n        });\n\n        //鼠标移动  确定矩形大小\n        $container.on('mousemove', (event)=> {\n            if($file[0].files.length == 0) return false;\n            if(is_start) {\n                    drop_width = event.pageX-iClientX;//鼠标X轴滑动距离, 即矩形宽\n                    drop_height = event.pageY-iClientY; //鼠标Y轴滑动距离, 即矩形高\n                let drop_top_final = iOffsetY + drop_height, //滑动top终点位置\n                    drop_left_final = iOffsetX + drop_width, //滑动left终点位置\n                    distance_x_limit = $('.box').width() - iOffsetX, //x最大滑动距离\n                    distance_y_limit = $('.box').height() - iOffsetY; //y最大滑动距离\n                //移动边界检测\n                choosed_area.forEach((ele, index)=>{\n                    let choosed_top_final = ele.top + ele.height; //已选区域 top终点值\n                    let choosed_left_final = ele.left + ele.width; //已选区域 left终点值\n                    \n                    //移动超出边界\n                    // 滑动距离超出边界\n                    (drop_height > distance_y_limit)|| (drop_width > distance_x_limit) && (is_start = false);\n                })\n                // 通过长宽变化绘制矩形\n                $('.drop-box').css({\n                    'width': `${drop_width}px`,\n                    'height': `${drop_height}px`\n                })\n\n            }else {\n                //重置状态\n                //移除矩形 重新进行绘制\n                $('.drop-box').css({\n                    'width': 0,\n                    'height': 0,\n                    'display': 'none',\n                    'top': 0,\n                    'left': 0,\n                    'position': 'static' \n                });\n            }\n            return false;\n        });\n        //鼠标抬起 重置状态 \n        $container.on('mouseup', ()=>{\n            if($file[0].files.length === 0) return false;\n            if(is_start){\n                \n                //绘制替代矩形\n                $('.complete-box').css({\n                    'width': `${drop_width}px`,\n                    'height': `${drop_height}px`,\n                    'top': `${iOffsetY}px`,\n                    'left': `${iOffsetX}px`,\n                    'display': 'block'\n                });\n                //获取canvas上绘制矩形数据\n                var clipImg = ctx.getImageData( iOffsetX, iOffsetY, drop_width, drop_height);\n                $clip[0].width = drop_width;\n                $clip[0].height = drop_height;\n                var set = clip_ctx.putImageData(clipImg, 0, 0);  \n                var imgurl = $clip[0].toDataURL();\n                $('.save').prop('href', imgurl);\n                $('.save').prop('download', imgurl);\n                // 绘制状态置为false\n                is_start = false;\n                $('.btn').prop('disabled', false);\n                let position_txt = `top:${iOffsetY}, left:${iOffsetX}, width:${$('.drop-box').width()}, height:${$('.drop-box').height()}`;\n                $('.position-txt').html(position_txt);\n            }\n            \n        });\n        //按钮 重置选区 保存截图\n        $container.after(`\n            <div style=\"color:gray\"><span>* 上传图片,拖动鼠标选择要截图的区域, 保存截图 </span></div>\n            <div class=\"position-txt\"></div>\n            <div class=\"btn-group\">\n                <button  class=\"btn reset\" type=\"button\" disabled>重置 X</button>\n                <button class=\"btn save\" href=\"javascript:;\" download=\"pic.jpeg\" disabled>保存截图</button>\n                <a class=\"btn save\" href=\"javascript:;\" download=\"pic.jpeg\" style=\"visibility:hidden\"><span class=\"span_save\">保存截图</span></a>\n            </div>\n        `);\n        //重置\n        $('.reset').on('click', reset_position);\n        function reset_position() {\n            $('.complete-box').css({\n                'width': 0,\n                'height': 0,\n                'top': 0,\n                'left': 0,\n                'display': 'none'\n            });\n            $('.btn').prop('disabled', true);\n            $('.position-txt').html('');\n        }\n        $('[disabled]').on('click', function(){\n            return false;\n        })\n        $('button.save').on('click', function(){\n            $('.span_save').trigger(\"click\");\n        })\n        \n    }\n    //数据绑定\n    function bindModelInput(obj, property, domElem) {\n        Object.defineProperty(obj, property, {\n            get: function() { return domElem.value; }, \n            set: function(newValue) { domElem.value = newValue; },\n            configurable: true\n        });\n    }\n\n    //<input id=\"foo\">\n    let user = {};\n    bindModelInput(user,'name',document.getElementById('foo'));\n    //调用 进行绘制\n    $(function(){\n        print({\n            container: \".box\"\n        });\n    })\n    "]}